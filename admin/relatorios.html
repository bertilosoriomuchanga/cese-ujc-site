<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Relat√≥rios - CESE-UJC</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #1a3a8f;
            --primary-dark: #0d2a6d;
            --secondary: #d4af37;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #e1e5eb;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
            z-index: 1000;
        }
        
        .logo {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .logo h2 {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .logo p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .user-info {
            padding: 15px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .user-info h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .user-info .user-role {
            background: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: inline-block;
        }
        
        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #555;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(26, 58, 143, 0.1);
            color: var(--primary);
        }
        
        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .logout-btn {
            margin: 20px 15px 0;
            display: block;
            width: calc(100% - 30px);
            text-align: center;
            padding: 12px;
            background: var(--light);
            color: var(--danger);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
            min-height: 100vh;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .page-title h1 {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .page-title p {
            color: #666;
            margin-top: 5px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 58, 143, 0.3);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        /* Report Filters */
        .report-filters {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 58, 143, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.2rem;
            color: var(--dark);
            font-weight: 600;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Reports List */
        .reports-list {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .report-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .report-card.finance { border-color: var(--success); }
        .report-card.members { border-color: #3498db; }
        .report-card.events { border-color: #9b59b6; }
        
        .report-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .report-card.finance .report-icon { color: var(--success); }
        .report-card.members .report-icon { color: #3498db; }
        .report-card.events .report-icon { color: #9b59b6; }
        
        .report-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .report-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
        }
        
        .report-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .report-btn.view {
            background: var(--primary);
            color: white;
        }
        
        .report-btn.download {
            background: var(--light);
            color: #555;
            border: 1px solid var(--border);
        }
        
        .report-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .summary-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .summary-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .summary-label {
            color: #666;
            font-size: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo h2,
            .sidebar .logo p,
            .sidebar .user-info h3,
            .sidebar .user-info .user-role,
            .sidebar .nav-link span,
            .sidebar .logout-btn span {
                display: none;
            }
            
            .sidebar .logo,
            .sidebar .user-info,
            .sidebar .nav-link,
            .sidebar .logout-btn {
                text-align: center;
                justify-content: center;
                padding: 15px 5px;
            }
            
            .sidebar .nav-link i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h2>üìä CESE-UJC</h2>
            <p>Relat√≥rios e Estat√≠sticas</p>
        </div>
        
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-chart-bar"></i>
            </div>
            <h3 id="userName">Administrador</h3>
            <span class="user-role" id="userRole">ADMIN</span>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard-admin.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="gerir-membros.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Membros</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="gerir-financas.html" class="nav-link">
                    <i class="fas fa-coins"></i>
                    <span>Finan√ßas</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="gerir-eventos.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Eventos</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="relatorios.html" class="nav-link active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relat√≥rios</span>
                </a>
            </li>
        </ul>
        
        <a href="index.html" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Sair</span>
        </a>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="page-header">
            <div class="page-title">
                <h1>üìä Relat√≥rios e Estat√≠sticas</h1>
                <p>An√°lise e relat√≥rios do CESE-UJC</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="gerarRelatorioCompleto()">
                    <i class="fas fa-file-pdf"></i>
                    Relat√≥rio Completo
                </button>
                <button class="btn btn-success" onclick="exportarTodosDados()">
                    <i class="fas fa-download"></i>
                    Exportar Todos Dados
                </button>
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="summary-number" id="totalMembros">0</div>
                <div class="summary-label">Total de Membros</div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="summary-number" id="receitaTotal">0 MT</div>
                <div class="summary-label">Receita Total</div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="summary-number" id="totalEventos">0</div>
                <div class="summary-label">Eventos Realizados</div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="summary-number" id="taxaCrescimento">0%</div>
                <div class="summary-label">Taxa de Crescimento</div>
            </div>
        </div>
        
        <!-- Report Filters -->
        <div class="report-filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="reportPeriod">Per√≠odo do Relat√≥rio</label>
                    <select id="reportPeriod" onchange="atualizarGraficos()">
                        <option value="month">Este M√™s</option>
                        <option value="quarter">Este Trimestre</option>
                        <option value="semester">Este Semestre</option>
                        <option value="year">Este Ano</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="reportType">Tipo de Relat√≥rio</label>
                    <select id="reportType" onchange="atualizarGraficos()">
                        <option value="finance">Financeiro</option>
                        <option value="members">Membros</option>
                        <option value="events">Eventos</option>
                        <option value="all">Todos</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="startDate">Data In√≠cio (Personalizado)</label>
                    <input type="date" id="startDate" onchange="atualizarGraficos()">
                </div>
                
                <div class="filter-group">
                    <label for="endDate">Data Fim (Personalizado)</label>
                    <input type="date" id="endDate" onchange="atualizarGraficos()">
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn" onclick="atualizarGraficos()" style="background: var(--light);">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
                <button class="btn btn-primary" onclick="filtrarRelatorios()">
                    <i class="fas fa-filter"></i> Aplicar Filtros
                </button>
            </div>
        </div>
        
        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Gr√°fico 1: Quotas por M√™s -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">üí∞ Quotas por M√™s</h3>
                    <button class="btn" onclick="exportarGrafico('quotasChart')" style="background: var(--light); padding: 8px 15px;">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <div class="chart-container">
                    <canvas id="quotasChart"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico 2: Distribui√ß√£o de Membros -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">üë• Distribui√ß√£o de Membros</h3>
                    <button class="btn" onclick="exportarGrafico('membersChart')" style="background: var(--light); padding: 8px 15px;">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <div class="chart-container">
                    <canvas id="membersChart"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico 3: Participa√ß√£o em Eventos -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">üìÖ Participa√ß√£o em Eventos</h3>
                    <button class="btn" onclick="exportarGrafico('eventsChart')" style="background: var(--light); padding: 8px 15px;">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <div class="chart-container">
                    <canvas id="eventsChart"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico 4: Status de Quotas -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">üìä Status de Quotas</h3>
                    <button class="btn" onclick="exportarGrafico('statusChart')" style="background: var(--light); padding: 8px 15px;">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Reports List -->
        <div class="reports-list">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-file-alt"></i>
                    Relat√≥rios Dispon√≠veis
                </h2>
            </div>
            
            <div class="reports-grid">
                <!-- Relat√≥rio Financeiro -->
                <div class="report-card finance">
                    <div class="report-icon">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <h3>Relat√≥rio Financeiro</h3>
                    <p>Relat√≥rio detalhado de receitas, despesas e status de quotas</p>
                    <div class="report-actions">
                        <button class="report-btn view" onclick="verRelatorioFinanceiro()">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="report-btn download" onclick="baixarRelatorioFinanceiro()">
                            <i class="fas fa-download"></i> PDF
                        </button>
                    </div>
                </div>
                
                <!-- Relat√≥rio de Membros -->
                <div class="report-card members">
                    <div class="report-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Relat√≥rio de Membros</h3>
                    <p>Lista completa de membros, status e hist√≥rico de participa√ß√£o</p>
                    <div class="report-actions">
                        <button class="report-btn view" onclick="verRelatorioMembros()">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="report-btn download" onclick="baixarRelatorioMembros()">
                            <i class="fas fa-download"></i> Excel
                        </button>
                    </div>
                </div>
                
                <!-- Relat√≥rio de Eventos -->
                <div class="report-card events">
                    <div class="report-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3>Relat√≥rio de Eventos</h3>
                    <p>Calend√°rio de eventos, participa√ß√£o e feedback</p>
                    <div class="report-actions">
                        <button class="report-btn view" onclick="verRelatorioEventos()">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="report-btn download" onclick="baixarRelatorioEventos()">
                            <i class="fas fa-download"></i> PDF
                        </button>
                    </div>
                </div>
                
                <!-- Relat√≥rio Anual -->
                <div class="report-card">
                    <div class="report-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Relat√≥rio Anual 2026</h3>
                    <p>Relat√≥rio completo de atividades e resultados do ano</p>
                    <div class="report-actions">
                        <button class="report-btn view" onclick="verRelatorioAnual()">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="report-btn download" onclick="baixarRelatorioAnual()">
                            <i class="fas fa-download"></i> PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Relat√≥rios
        const MEMBROS_KEY = 'cese_membros';
        const PAGAMENTOS_KEY = 'cese_pagamentos';
        const EVENTOS_KEY = 'cese_eventos';
        
        let quotasChart = null;
        let membersChart = null;
        let eventsChart = null;
        let statusChart = null;
        
        // Verificar login
        function verificarLogin() {
            const sessao = localStorage.getItem('cese_sessao');
            if (!sessao) {
                window.location.href = 'index.html';
                return;
            }
            
            const usuario = JSON.parse(sessao);
            if (usuario.nivel !== 'admin' && usuario.nivel !== 'cfo') {
                window.location.href = 'index.html';
                return;
            }
            
            document.getElementById('userName').textContent = usuario.nome;
            document.getElementById('userRole').textContent = usuario.cargo;
            
            return usuario;
        }
        
        // Carregar dados
        function carregarDados() {
            verificarLogin();
            
            // Configurar datas
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            
            document.getElementById('startDate').valueAsDate = primeiroDiaMes;
            document.getElementById('endDate').valueAsDate = hoje;
            
            atualizarResumo();
            inicializarGraficos();
        }
        
        // Atualizar resumo
        function atualizarResumo() {
            // Carregar dados
            const membros = JSON.parse(localStorage.getItem(MEMBROS_KEY) || '[]');
            const pagamentos = JSON.parse(localStorage.getItem(PAGAMENTOS_KEY) || '[]');
            const eventos = JSON.parse(localStorage.getItem(EVENTOS_KEY) || '[]');
            
            // Estat√≠sticas
            document.getElementById('totalMembros').textContent = membros.length;
            
            // Receita total
            const receitaTotal = pagamentos.reduce((sum, p) => sum + (p.valor || 0), 0);
            document.getElementById('receitaTotal').textContent = `${receitaTotal} MT`;
            
            // Total de eventos
            document.getElementById('totalEventos').textContent = eventos.length;
            
            // Taxa de crescimento (simulada)
            const crescimento = membros.length > 0 ? Math.round((membros.length / 50) * 100) : 0;
            document.getElementById('taxaCrescimento').textContent = `${crescimento}%`;
        }
        
        // Inicializar gr√°ficos
        function inicializarGraficos() {
            // Destruir gr√°ficos existentes
            if (quotasChart) quotasChart.destroy();
            if (membersChart) membersChart.destroy();
            if (eventsChart) eventsChart.destroy();
            if (statusChart) statusChart.destroy();
            
            // Carregar dados
            const membros = JSON.parse(localStorage.getItem(MEMBROS_KEY) || '[]');
            const pagamentos = JSON.parse(localStorage.getItem(PAGAMENTOS_KEY) || '[]');
            const eventos = JSON.parse(localStorage.getItem(EVENTOS_KEY) || '[]');
            
            // Gr√°fico 1: Quotas por M√™s
            const quotasCtx = document.getElementById('quotasChart').getContext('2d');
            const dadosQuotas = calcularQuotasPorMes(pagamentos);
            
            quotasChart = new Chart(quotasCtx, {
                type: 'line',
                data: {
                    labels: dadosQuotas.meses,
                    datasets: [{
                        label: 'Receita de Quotas (MT)',
                        data: dadosQuotas.valores,
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + ' MT';
                                }
                            }
                        }
                    }
                }
            });
            
            // Gr√°fico 2: Distribui√ß√£o de Membros
            const membersCtx = document.getElementById('membersChart').getContext('2d');
            const dadosMembros = calcularDistribuicaoMembros(membros);
            
            membersChart = new Chart(membersCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Administradores', 'CFOs', 'Membros'],
                    datasets: [{
                        data: [
                            dadosMembros.admins,
                            dadosMembros.cfos,
                            dadosMembros.membros
                        ],
                        backgroundColor: [
                            '#d4af37',
                            '#2ecc71',
                            '#3498db'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Gr√°fico 3: Participa√ß√£o em Eventos
            const eventsCtx = document.getElementById('eventsChart').getContext('2d');
            const dadosEventos = calcularParticipacaoEventos(eventos);
            
            eventsChart = new Chart(eventsCtx, {
                type: 'bar',
                data: {
                    labels: dadosEventos.titulos,
                    datasets: [{
                        label: 'Participantes',
                        data: dadosEventos.participantes,
                        backgroundColor: '#9b59b6',
                        borderColor: '#8e44ad',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
            
            // Gr√°fico 4: Status de Quotas
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const dadosStatus = calcularStatusQuotas(membros);
            
            statusChart = new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: ['Pagas', 'Pendentes', 'Em Atraso'],
                    datasets: [{
                        data: [
                            dadosStatus.pagas,
                            dadosStatus.pendentes,
                            dadosStatus.atraso
                        ],
                        backgroundColor: [
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // Fun√ß√µes de c√°lculo
        function calcularQuotasPorMes(pagamentos) {
            const hoje = new Date();
            const meses = [];
            const valores = [];
            
            // √öltimos 6 meses
            for (let i = 5; i >= 0; i--) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                const mes = data.toLocaleDateString('pt-MZ', { month: 'short' });
                meses.push(mes);
                
                // Filtrar pagamentos deste m√™s
                const mesStr = `${data.getFullYear()}-${(data.getMonth() + 1).toString().padStart(2, '0')}`;
                const pagamentosMes = pagamentos.filter(p => p.mes === mesStr);
                const totalMes = pagamentosMes.reduce((sum, p) => sum + (p.valor || 0), 0);
                valores.push(totalMes);
            }
            
            return { meses, valores };
        }
        
        function calcularDistribuicaoMembros(membros) {
            return {
                admins: membros.filter(m => m.nivel === 'admin').length,
                cfos: membros.filter(m => m.nivel === 'cfo').length,
                membros: membros.filter(m => m.nivel === 'membro').length
            };
        }
        
        function calcularParticipacaoEventos(eventos) {
            // Pegar √∫ltimos 5 eventos
            const eventosRecentes = eventos
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            return {
                titulos: eventosRecentes.map(e => e.title.substring(0, 15) + '...'),
                participantes: eventosRecentes.map(e => e.currentParticipants || 0)
            };
        }
        
        function calcularStatusQuotas(membros) {
            const hoje = new Date();
            const diaAtual = hoje.getDate();
            
            return {
                pagas: membros.filter(m => m.quotaStatus === 'paid').length,
                pendentes: membros.filter(m => m.quotaStatus !== 'paid' && diaAtual <= 16).length,
                atraso: membros.filter(m => m.quotaStatus !== 'paid' && diaAtual > 16).length
            };
        }
        
        // Fun√ß√µes de relat√≥rios
        function atualizarGraficos() {
            inicializarGraficos();
        }
        
        function filtrarRelatorios() {
            alert('Filtrando relat√≥rios...\nFuncionalidade completa em desenvolvimento.');
        }
        
        function exportarGrafico(chartId) {
            const chart = getChartByName(chartId);
            if (chart) {
                const link = document.createElement('a');
                link.download = `grafico-${chartId}.png`;
                link.href = chart.toBase64Image();
                link.click();
            }
        }
        
        function getChartByName(name) {
            switch(name) {
                case 'quotasChart': return quotasChart;
                case 'membersChart': return membersChart;
                case 'eventsChart': return eventsChart;
                case 'statusChart': return statusChart;
                default: return null;
            }
        }
        
        // Fun√ß√µes de relat√≥rios espec√≠ficos
        function verRelatorioFinanceiro() {
            const pagamentos = JSON.parse(localStorage.getItem(PAGAMENTOS_KEY) || '[]');
            const receitaTotal = pagamentos.reduce((sum, p) => sum + (p.valor || 0), 0);
            
            const conteudo = `
                üìä RELAT√ìRIO FINANCEIRO CESE-UJC
                ================================
                
                üí∞ Receita Total: ${receitaTotal} MT
                üìà Total de Transa√ß√µes: ${pagamentos.length}
                
                √öltimos Pagamentos:
                ${pagamentos.slice(-5).map(p => `
                    ‚Ä¢ ${p.membroNome}: ${p.valor} MT (${p.mes})
                `).join('')}
                
                üí° Recomenda√ß√µes:
                1. Aumentar conscientiza√ß√£o sobre quotas
                2. Implementar sistema de pagamento online
                3. Revisar valores de quotas para 2027
            `;
            
            alert(conteudo);
        }
        
        function baixarRelatorioFinanceiro() {
            gerarPDF('Relat√≥rio Financeiro', 'financeiro');
        }
        
        function verRelatorioMembros() {
            const membros = JSON.parse(localStorage.getItem(MEMBROS_KEY) || '[]');
            
            const conteudo = `
                üë• RELAT√ìRIO DE MEMBROS CESE-UJC
                ================================
                
                Total de Membros: ${membros.length}
                
                Distribui√ß√£o por N√≠vel:
                ‚Ä¢ Administradores: ${membros.filter(m => m.nivel === 'admin').length}
                ‚Ä¢ CFOs: ${membros.filter(m => m.nivel === 'cfo').length}
                ‚Ä¢ Membros: ${membros.filter(m => m.nivel === 'membro').length}
                
                Status de Quotas:
                ‚Ä¢ Em dia: ${membros.filter(m => m.quotaStatus === 'paid').length}
                ‚Ä¢ Pendentes: ${membros.filter(m => m.quotaStatus !== 'paid').length}
            `;
            
            alert(conteudo);
        }
        
        function baixarRelatorioMembros() {
            const membros = JSON.parse(localStorage.getItem(MEMBROS_KEY) || '[]');
            const csv = membros.map(m => 
                `"${m.nome}","${m.email}","${m.nivel}","${m.quotaMensal} MT","${m.quotaStatus}"`
            ).join('\n');
            
            const headers = 'Nome,Email,N√≠vel,Quota Mensal,Status';
            exportarCSV('relatorio-membros.csv', headers + '\n' + csv);
        }
        
        function verRelatorioEventos() {
            const eventos = JSON.parse(localStorage.getItem(EVENTOS_KEY) || '[]');
            
            const conteudo = `
                üìÖ RELAT√ìRIO DE EVENTOS CESE-UJC
                ================================
                
                Total de Eventos: ${eventos.length}
                
                Pr√≥ximos Eventos:
                ${eventos
                    .filter(e => new Date(e.date) >= new Date())
                    .slice(0, 3)
                    .map(e => `
                    ‚Ä¢ ${e.title} (${new Date(e.date).toLocaleDateString('pt-MZ')})
                      ${e.location} - ${e.currentParticipants || 0} participantes
                    `).join('')}
                
                üí° Recomenda√ß√µes:
                1. Diversificar tipos de eventos
                2. Melhorar divulga√ß√£o
                3. Coletar feedback sistem√°tico
            `;
            
            alert(conteudo);
        }
        
        function baixarRelatorioEventos() {
            gerarPDF('Relat√≥rio de Eventos', 'eventos');
        }
        
        function verRelatorioAnual() {
            alert('üìà Relat√≥rio Anual 2026\n\nEm desenvolvimento...\n\nEsta funcionalidade gerar√° um relat√≥rio completo com:\n‚Ä¢ An√°lise financeira anual\n‚Ä¢ Crescimento de membros\n‚Ä¢ Impacto dos eventos\n‚Ä¢ Metas para 2027');
        }
        
        function baixarRelatorioAnual() {
            gerarPDF('Relat√≥rio Anual 2026', 'anual');
        }
        
        function gerarRelatorioCompleto() {
            alert('üìã Gerando Relat√≥rio Completo...\n\nEste relat√≥rio incluir√°:\n1. An√°lise Financeira Detalhada\n2. Estat√≠sticas de Membros\n3. Relat√≥rio de Eventos\n4. Recomenda√ß√µes Estrat√©gicas\n\nO download iniciar√° em breve...');
            
            setTimeout(() => {
                gerarPDF('Relat√≥rio Completo CESE-UJC', 'completo');
            }, 1000);
        }
        
        function exportarTodosDados() {
            const membros = JSON.parse(localStorage.getItem(MEMBROS_KEY) || '[]');
            const pagamentos = JSON.parse(localStorage.getItem(PAGAMENTOS_KEY) || '[]');
            const eventos = JSON.parse(localStorage.getItem(EVENTOS_KEY) || '[]');
            
            const data = {
                membros: membros,
                pagamentos: pagamentos,
                eventos: eventos,
                exportDate: new Date().toISOString(),
                sistema: 'CESE-UJC Gest√£o'
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-cese-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Fun√ß√µes auxiliares
        function exportarCSV(filename, content) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function gerarPDF(titulo, tipo) {
            const conteudo = `
                <html>
                <head>
                    <title>${titulo}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 30px; }
                        .header { text-align: center; margin-bottom: 40px; }
                        .content { margin: 20px 0; }
                        .footer { margin-top: 50px; text-align: center; font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${titulo}</h1>
                        <h3>CESE-UJC - Clube de Estudos Sociais e Econ√¥micos</h3>
                        <p>Gerado em: ${new Date().toLocaleDateString('pt-MZ')}</p>
                    </div>
                    
                    <div class="content">
                        <h2>Resumo Executivo</h2>
                        <p>Este relat√≥rio apresenta uma an√°lise completa das atividades do CESE-UJC.</p>
                        
                        <h2>Principais M√©tricas</h2>
                        <table>
                            <tr>
                                <th>M√©trica</th>
                                <th>Valor</th>
                            </tr>
                            <tr>
                                <td>Total de Membros</td>
                                <td>${document.getElementById('totalMembros').textContent}</td>
                            </tr>
                            <tr>
                                <td>Receita Total</td>
                                <td>${document.getElementById('receitaTotal').textContent}</td>
                            </tr>
                            <tr>
                                <td>Eventos Realizados</td>
                                <td>${document.getElementById('totalEventos').textContent}</td>
                            </tr>
                        </table>
                        
                        <h2>Recomenda√ß√µes</h2>
                        <p>1. Fortalecer o sistema de gest√£o de membros</p>
                        <p>2. Diversificar fontes de receita</p>
                        <p>3. Expandir parcerias institucionais</p>
                    </div>
                    
                    <div class="footer">
                        <p>CESE-UJC | Universidade Joaquim Chissano</p>
                        <p>Email: cese.ujc@gmail.com | Website: https://bertilosoriomuchanga.github.io/cese-ujc-site/</p>
                    </div>
                </body>
                </html>
            `;
            
            const janela = window.open('', '_blank');
            janela.document.write(conteudo);
            janela.document.close();
            janela.print();
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', carregarDados);
    </script>
</body>
</html>